<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Pong</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #0d0d1a; /* Dark Navy Background */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.2);
            border: 4px solid #333;
            border-radius: 4px;
        }

        canvas {
            display: block;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
        }

        /* UI Overlay for Start Screen */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            transition: opacity 0.3s;
        }

        h1 {
            font-size: 60px;
            margin: 0;
            text-transform: uppercase;
            text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
            color: #fff;
        }

        p {
            font-size: 18px;
            color: #ddd;
            margin-bottom: 30px;
        }

        button {
            padding: 15px 40px;
            font-size: 24px;
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            text-transform: uppercase;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            transition: all 0.2s;
        }

        button:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="pongCanvas" width="800" height="600"></canvas>
    
    <div id="ui-layer">
        <h1>NEON PONG</h1>
        <p>Use Mouse or Arrow Keys to Move</p>
        <button id="startBtn">Start Game</button>
    </div>
</div>

<script>
    // --- Configuration ---
    const canvas = document.getElementById('pongCanvas');
    const ctx = canvas.getContext('2d');
    const uiLayer = document.getElementById('ui-layer');
    const startBtn = document.getElementById('startBtn');

    // Game Objects
    const ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: 10,
        speed: 7,
        velocityX: 5,
        velocityY: 5,
        color: '#ffff00' // Yellow
    };

    const user = {
        x: 0,
        y: (canvas.height - 100) / 2,
        width: 15,
        height: 100,
        score: 0,
        color: '#00ffff' // Cyan
    };

    const com = {
        x: canvas.width - 15,
        y: (canvas.height - 100) / 2,
        width: 15,
        height: 100,
        score: 0,
        color: '#ff00ff', // Magenta
        speed: 0.09 // Computer Difficulty (0.1 is hard, 0.05 is easy)
    };

    const net = {
        x: (canvas.width - 2) / 2,
        y: 0,
        height: 10,
        width: 2,
        color: '#333'
    };

    let isGameRunning = false;
    let animationId;

    // --- Audio System (Web Audio API) ---
    // We use this so we don't need external mp3 files
    let audioCtx;
    
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    function playSound(type) {
        if (!audioCtx) return;
        
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        const now = audioCtx.currentTime;

        if (type === 'hit') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now);
            osc.stop(now + 0.1);
        } else if (type === 'wall') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(200, now);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
            osc.start(now);
            osc.stop(now + 0.05);
        } else if (type === 'score') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.linearRampToValueAtTime(1000, now + 0.1);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.linearRampToValueAtTime(0.01, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
        }
    }

    // --- Drawing Functions ---

    function drawRect(x, y, w, h, color, glow = false) {
        ctx.fillStyle = color;
        if(glow) {
            ctx.shadowBlur = 20;
            ctx.shadowColor = color;
        } else {
            ctx.shadowBlur = 0;
        }
        ctx.fillRect(x, y, w, h);
        ctx.shadowBlur = 0; // Reset
    }

    function drawArc(x, y, r, color) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.shadowBlur = 15;
        ctx.shadowColor = color;
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    function drawNet() {
        for (let i = 0; i <= canvas.height; i += 15) {
            drawRect(net.x, net.y + i, net.width, net.height, net.color);
        }
    }

    function drawText(text, x, y, color) {
        ctx.fillStyle = color;
        ctx.font = "60px 'Courier New'";
        ctx.fillText(text, x, y);
    }

    // --- Game Logic ---

    function resetBall() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        ball.speed = 7;
        ball.velocityX = -ball.velocityX; // Send to winner
        ball.velocityY = 5 * (Math.random() > 0.5 ? 1 : -1);
    }

    function update() {
        // Move the ball
        ball.x += ball.velocityX;
        ball.y += ball.velocityY;

        // Computer AI (Simple tracking)
        // Lerp logic: Move current pos towards target pos by percentage
        com.y += (ball.y - (com.y + com.height / 2)) * com.speed;

        // Wall Collision (Top/Bottom)
        if (ball.y - ball.radius < 0 || ball.y + ball.radius > canvas.height) {
            ball.velocityY = -ball.velocityY;
            playSound('wall');
        }

        // Determine which player is being hit
        let player = (ball.x < canvas.width / 2) ? user : com;

        // Paddle Collision Detection
        if (collision(ball, player)) {
            playSound('hit');
            
            // Calculate where the ball hit the paddle
            let collidePoint = ball.y - (player.y + player.height / 2);
            // Normalize the value (-1 to 1)
            collidePoint = collidePoint / (player.height / 2);

            // Calculate angle in Radians (45 degrees max)
            let angleRad = (Math.PI / 4) * collidePoint;

            // Change velocity direction
            let direction = (ball.x < canvas.width / 2) ? 1 : -1;
            ball.velocityX = direction * ball.speed * Math.cos(angleRad);
            ball.velocityY = ball.speed * Math.sin(angleRad);

            // Speed up the game every hit
            ball.speed += 0.2;
        }

        // Scoring
        if (ball.x - ball.radius < 0) {
            // Com scores
            com.score++;
            playSound('score');
            resetBall();
        } else if (ball.x + ball.radius > canvas.width) {
            // User scores
            user.score++;
            playSound('score');
            resetBall();
        }
    }

    function collision(b, p) {
        p.top = p.y;
        p.bottom = p.y + p.height;
        p.left = p.x;
        p.right = p.x + p.width;

        b.top = b.y - b.radius;
        b.bottom = b.y + b.radius;
        b.left = b.x - b.radius;
        b.right = b.x + b.radius;

        return b.right > p.left && b.bottom > p.top && b.left < p.right && b.top < p.bottom;
    }

    function render() {
        // Clear Canvas
        drawRect(0, 0, canvas.width, canvas.height, "rgba(0,0,0,0.2)"); // Trail effect

        drawNet();

        // Draw Score
        drawText(user.score, canvas.width / 4, canvas.height / 5, "#fff");
        drawText(com.score, 3 * canvas.width / 4, canvas.height / 5, "#fff");

        // Draw Paddles
        drawRect(user.x, user.y, user.width, user.height, user.color, true);
        drawRect(com.x, com.y, com.width, com.height, com.color, true);

        // Draw Ball
        drawArc(ball.x, ball.y, ball.radius, ball.color);
    }

    function gameLoop() {
        if(isGameRunning) {
            update();
            render();
            animationId = requestAnimationFrame(gameLoop);
        }
    }

    // --- Controls ---
    
    // Mouse Control
    canvas.addEventListener("mousemove", (evt) => {
        let rect = canvas.getBoundingClientRect();
        user.y = evt.clientY - rect.top - user.height / 2;
    });

    // Keyboard Control
    document.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowUp') user.y -= 30;
        if(e.key === 'ArrowDown') user.y += 30;
    });

    // Start Button
    startBtn.addEventListener('click', () => {
        initAudio();
        uiLayer.classList.add('hidden');
        isGameRunning = true;
        gameLoop();
    });

</script>
</body>
</html>